<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Map Route Visualization</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map { height: 80vh; }
        .controls { margin: 10px; }
        button { padding: 10px 20px; margin-top: 10px; }
    </style>
</head>
<body>
<div class="controls">
    <input type="number" id="distanceInput" placeholder="Input Distance (km)" />

    <!-- Elevation and POI preference selection -->
    <label for="elevationSelect">Elevation:</label>
    <select id="elevationSelect">
        <option value="max">Max</option>
        <option value="min">Min</option>
    </select>
    
    <label for="poiSelect">POI:</label>
    <select id="poiSelect">
        <option value="max">Max</option>
        <option value="min">Min</option>
    </select>

    <button onclick="calculateRoute()">Get Route</button>
    <div id="distanceDisplay" style="margin-top: 10px;">Distance: N/A</div>
    <div id="elevationDisplay" style="margin-top: 10px;">Elevation Change: N/A</div>
    <div id="poiDisplay" style="margin-top: 10px;">POI Count: N/A</div>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    const map = L.map("map").setView([49.174, -123.184], 15);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
    }).addTo(map);

    let source = [49.2292, -122.9932];
    let target = [49.2813912, -123.1217871];
    let pathLayer;

    async function calculateRoute() {
        const inputDistance = parseFloat(document.getElementById("distanceInput").value);
        const elevation = document.getElementById("elevationSelect").value;
        const poi = document.getElementById("poiSelect").value;

        if (isNaN(inputDistance) || inputDistance <= 0) {
            alert("Please enter a valid distance in km.");
            return;
        }

        try {
            const response = await fetch("http://127.0.0.1:5000/route", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ source, target, input_distance: inputDistance, elevation, poi }),
            });

            if (!response.ok) throw new Error("Failed to fetch route");

            const data = await response.json();
            const bestPath = data.best_path;

            if (pathLayer) map.removeLayer(pathLayer);
            pathLayer = L.polyline(bestPath.path_segments, { color: 'blue', weight: 5 }).addTo(map);
            map.fitBounds(pathLayer.getBounds());

            document.getElementById("distanceDisplay").innerText = `Distance: ${bestPath.distance} km`;
            document.getElementById("elevationDisplay").innerText = `Elevation Change: ${bestPath.elevation_change} m`;
            document.getElementById("poiDisplay").innerText = `POI Count: ${bestPath.poi_count}`;

        } catch (error) {
            console.error("Error:", error);
            alert("Error fetching the route.");
        }
    }
</script>
</body>
</html>
